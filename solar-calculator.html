<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Solar Energy Calculator Pakistan</title>
<meta name="description" content="Calculate how much solar energy you need for your home in Pakistan. Free solar panel calculator with accurate estimates, cost analysis and savings report.">
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

:root {
  --sun: #FFB800;
  --sun2: #FF8C00;
  --orange: #FF6B2B;
  --dark: #080C10;
  --dark2: #0F1419;
  --dark3: #161D27;
  --dark4: #1E2733;
  --text: #E8EDF3;
  --muted: #7A8899;
  --green: #2ECC71;
  --blue: #3498DB;
  --border: rgba(255,184,0,0.12);
  --border2: rgba(255,255,255,0.06);
}

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--dark);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
}

/* Ambient glow */
.ambient {
  position: fixed;
  border-radius: 50%;
  pointer-events: none;
  z-index: 0;
  filter: blur(80px);
}
.ambient-1 {
  width: 600px; height: 600px;
  top: -200px; left: -100px;
  background: radial-gradient(circle, rgba(255,184,0,0.07) 0%, transparent 70%);
  animation: float1 8s ease-in-out infinite;
}
.ambient-2 {
  width: 500px; height: 500px;
  bottom: -150px; right: -100px;
  background: radial-gradient(circle, rgba(255,107,43,0.05) 0%, transparent 70%);
  animation: float2 10s ease-in-out infinite;
}

@keyframes float1 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(30px,40px)} }
@keyframes float2 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(-20px,-30px)} }

/* HEADER */
header {
  position: relative; z-index: 10;
  padding: 20px 40px;
  display: flex; align-items: center; justify-content: space-between;
  border-bottom: 1px solid var(--border);
  backdrop-filter: blur(10px);
}

.logo {
  font-family: 'Syne', sans-serif;
  font-weight: 800; font-size: 1.4rem;
  display: flex; align-items: center; gap: 10px;
}
.logo-icon {
  width: 36px; height: 36px;
  background: linear-gradient(135deg, var(--sun), var(--orange));
  border-radius: 10px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.2rem;
}
.logo span { color: var(--sun); }

.lang-toggle {
  display: flex; gap: 4px;
  background: var(--dark3);
  border-radius: 8px; padding: 4px;
}
.lang-btn {
  padding: 6px 14px; border-radius: 6px; border: none;
  font-family: 'DM Sans', sans-serif; font-size: 0.82rem; font-weight: 500;
  cursor: pointer; transition: all 0.2s;
  color: var(--muted); background: transparent;
}
.lang-btn.active {
  background: var(--sun); color: var(--dark); font-weight: 600;
}

/* HERO */
.hero {
  position: relative; z-index: 10;
  text-align: center;
  padding: 70px 20px 50px;
}

.hero-tag {
  display: inline-flex; align-items: center; gap: 6px;
  background: rgba(255,184,0,0.08);
  border: 1px solid rgba(255,184,0,0.25);
  color: var(--sun); padding: 6px 16px;
  border-radius: 100px; font-size: 0.8rem; font-weight: 500;
  margin-bottom: 24px; letter-spacing: 0.5px; text-transform: uppercase;
}

.hero h1 {
  font-family: 'Syne', sans-serif;
  font-size: clamp(2rem, 5vw, 3.6rem);
  font-weight: 800; line-height: 1.1;
  letter-spacing: -1px;
  max-width: 700px; margin: 0 auto 16px;
}
.hero h1 em { font-style: normal; color: var(--sun); }
.hero p {
  color: var(--muted); font-size: 1.1rem;
  max-width: 520px; margin: 0 auto;
  line-height: 1.6;
}

/* MAIN LAYOUT */
.container {
  position: relative; z-index: 10;
  max-width: 1100px;
  margin: 0 auto;
  padding: 0 20px 80px;
}

/* STEP INDICATORS */
.steps {
  display: flex; align-items: center; justify-content: center;
  gap: 0; margin-bottom: 40px;
}
.step {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 20px;
  border-radius: 100px;
  font-size: 0.85rem; font-weight: 500;
  color: var(--muted); transition: all 0.3s;
  cursor: pointer;
}
.step.active { background: rgba(255,184,0,0.1); color: var(--sun); }
.step.done { color: var(--green); }
.step-num {
  width: 26px; height: 26px;
  border-radius: 50%; display: flex; align-items: center; justify-content: center;
  font-size: 0.75rem; font-weight: 700;
  background: var(--dark3); border: 1px solid var(--border2);
  transition: all 0.3s;
}
.step.active .step-num { background: var(--sun); color: var(--dark); border-color: var(--sun); }
.step.done .step-num { background: var(--green); color: white; border-color: var(--green); }
.step-line { width: 40px; height: 1px; background: var(--border2); }

/* CARDS */
.card {
  background: var(--dark2);
  border: 1px solid var(--border2);
  border-radius: 20px;
  padding: 32px;
  margin-bottom: 20px;
  transition: border-color 0.3s;
}
.card:hover { border-color: var(--border); }

.card-header {
  display: flex; align-items: center; gap: 14px;
  margin-bottom: 28px;
}
.card-icon {
  width: 44px; height: 44px;
  background: linear-gradient(135deg, rgba(255,184,0,0.15), rgba(255,107,43,0.1));
  border: 1px solid rgba(255,184,0,0.2);
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 1.3rem;
}
.card-title {
  font-family: 'Syne', sans-serif;
  font-size: 1.15rem; font-weight: 700;
}
.card-sub { font-size: 0.82rem; color: var(--muted); margin-top: 3px; }

/* CITY SELECTOR */
.city-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
  gap: 10px;
}
.city-btn {
  padding: 12px 10px;
  border-radius: 12px; border: 1px solid var(--border2);
  background: var(--dark3);
  color: var(--text); font-family: 'DM Sans', sans-serif;
  font-size: 0.85rem; font-weight: 500;
  cursor: pointer; transition: all 0.2s;
  text-align: center;
}
.city-btn:hover { border-color: rgba(255,184,0,0.3); color: var(--sun); }
.city-btn.selected {
  background: rgba(255,184,0,0.1);
  border-color: var(--sun); color: var(--sun);
}
.city-sun { font-size: 0.72rem; color: var(--muted); margin-top: 3px; }
.city-btn.selected .city-sun { color: rgba(255,184,0,0.7); }

/* BILL INPUT */
.bill-input-wrap {
  position: relative; max-width: 360px;
}
.bill-input-wrap .currency {
  position: absolute; left: 16px; top: 50%; transform: translateY(-50%);
  color: var(--sun); font-weight: 600; font-size: 1rem;
  pointer-events: none;
}
.bill-input-wrap input {
  width: 100%; padding: 14px 16px 14px 50px;
  background: var(--dark3); border: 1px solid var(--border2);
  border-radius: 12px; color: var(--text);
  font-family: 'DM Sans', sans-serif; font-size: 1.1rem; font-weight: 500;
  outline: none; transition: border-color 0.2s;
}
.bill-input-wrap input:focus { border-color: var(--sun); }
.bill-input-wrap input::placeholder { color: var(--muted); font-weight: 400; }

/* APPLIANCES */
.appliance-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px; margin-bottom: 20px;
}
.appliance-item {
  background: var(--dark3); border: 1px solid var(--border2);
  border-radius: 14px; padding: 16px;
  transition: all 0.2s; cursor: pointer;
}
.appliance-item:hover { border-color: rgba(255,184,0,0.2); }
.appliance-item.selected {
  background: rgba(255,184,0,0.06);
  border-color: rgba(255,184,0,0.35);
}
.appliance-top {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 12px;
}
.appliance-emoji { font-size: 1.5rem; }
.appliance-check {
  width: 20px; height: 20px; border-radius: 6px;
  border: 1.5px solid var(--border2);
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s; font-size: 0.75rem;
}
.appliance-item.selected .appliance-check {
  background: var(--sun); border-color: var(--sun); color: var(--dark);
}
.appliance-name {
  font-size: 0.9rem; font-weight: 600; margin-bottom: 2px;
}
.appliance-watts { font-size: 0.75rem; color: var(--muted); margin-bottom: 10px; }
.appliance-controls {
  display: none; gap: 8px; align-items: center;
}
.appliance-item.selected .appliance-controls { display: flex; }
.hours-label { font-size: 0.75rem; color: var(--muted); }
.hours-input {
  width: 60px; padding: 6px 8px;
  background: var(--dark4); border: 1px solid var(--border2);
  border-radius: 8px; color: var(--text);
  font-family: 'DM Sans', sans-serif; font-size: 0.85rem;
  outline: none; text-align: center;
}
.hours-input:focus { border-color: var(--sun); }
.qty-wrap { display: flex; align-items: center; gap: 6px; margin-left: auto; }
.qty-btn {
  width: 22px; height: 22px; border-radius: 6px;
  border: 1px solid var(--border2); background: var(--dark4);
  color: var(--text); cursor: pointer; font-size: 0.9rem;
  display: flex; align-items: center; justify-content: center;
  transition: all 0.2s;
}
.qty-btn:hover { border-color: var(--sun); color: var(--sun); }
.qty-val { font-size: 0.85rem; font-weight: 600; min-width: 16px; text-align: center; }

/* CUSTOM APPLIANCE */
.custom-add {
  background: var(--dark3); border: 1px dashed rgba(255,184,0,0.2);
  border-radius: 14px; padding: 16px;
  display: flex; gap: 10px; align-items: flex-end; flex-wrap: wrap;
}
.custom-add label { font-size: 0.78rem; color: var(--muted); display: block; margin-bottom: 5px; }
.custom-add input {
  background: var(--dark4); border: 1px solid var(--border2);
  border-radius: 8px; padding: 8px 12px;
  color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 0.85rem;
  outline: none; width: 100%; transition: border-color 0.2s;
}
.custom-add input:focus { border-color: var(--sun); }
.custom-add .field { flex: 1; min-width: 120px; }
.add-btn {
  padding: 9px 18px; background: rgba(255,184,0,0.12);
  border: 1px solid rgba(255,184,0,0.3); border-radius: 8px;
  color: var(--sun); font-family: 'DM Sans', sans-serif;
  font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.2s;
  white-space: nowrap;
}
.add-btn:hover { background: rgba(255,184,0,0.2); }

/* OPTIONAL COST */
.optional-section {
  background: var(--dark3); border: 1px solid var(--border2);
  border-radius: 14px; padding: 20px;
  margin-top: 16px;
}
.optional-toggle {
  display: flex; align-items: center; gap: 10px;
  cursor: pointer; user-select: none;
}
.toggle-switch {
  width: 40px; height: 22px; border-radius: 100px;
  background: var(--dark4); border: 1px solid var(--border2);
  position: relative; transition: all 0.3s;
}
.toggle-switch::after {
  content: ''; position: absolute;
  width: 16px; height: 16px; border-radius: 50%;
  background: var(--muted); top: 2px; left: 2px;
  transition: all 0.3s;
}
.toggle-switch.on { background: rgba(255,184,0,0.2); border-color: var(--sun); }
.toggle-switch.on::after { background: var(--sun); transform: translateX(18px); }
.optional-label { font-size: 0.9rem; font-weight: 500; }
.optional-sub { font-size: 0.78rem; color: var(--muted); }
.optional-input-wrap { margin-top: 16px; display: none; }
.optional-input-wrap.show { display: block; }

/* CALCULATE BTN */
.calc-btn {
  width: 100%; padding: 18px;
  background: linear-gradient(135deg, var(--sun), var(--orange));
  border: none; border-radius: 14px;
  font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 700;
  color: var(--dark); cursor: pointer;
  transition: all 0.3s; letter-spacing: 0.3px;
  margin-top: 24px;
  box-shadow: 0 8px 32px rgba(255,184,0,0.2);
}
.calc-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 40px rgba(255,184,0,0.3);
}
.calc-btn:active { transform: translateY(0); }

/* RESULTS */
#results { display: none; }
#results.show { display: block; }

.results-header {
  display: flex; align-items: center; justify-content: space-between;
  flex-wrap: wrap; gap: 16px;
  margin-bottom: 28px;
}
.results-title {
  font-family: 'Syne', sans-serif; font-size: 1.5rem; font-weight: 800;
}

.pdf-btn {
  display: flex; align-items: center; gap: 8px;
  padding: 11px 22px;
  background: rgba(255,184,0,0.08);
  border: 1px solid rgba(255,184,0,0.25);
  border-radius: 10px; color: var(--sun);
  font-family: 'DM Sans', sans-serif; font-size: 0.9rem; font-weight: 600;
  cursor: pointer; transition: all 0.2s;
}
.pdf-btn:hover { background: rgba(255,184,0,0.15); }
.pdf-btn svg { width: 16px; height: 16px; }

/* STAT CARDS */
.stat-grid {
  display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 14px; margin-bottom: 24px;
}
.stat-card {
  background: var(--dark2); border: 1px solid var(--border2);
  border-radius: 16px; padding: 22px;
  position: relative; overflow: hidden;
  transition: border-color 0.3s;
}
.stat-card::before {
  content: ''; position: absolute;
  top: 0; left: 0; right: 0; height: 2px;
  border-radius: 16px 16px 0 0;
}
.stat-card.yellow::before { background: linear-gradient(90deg, var(--sun), var(--orange)); }
.stat-card.green::before { background: linear-gradient(90deg, #2ECC71, #27AE60); }
.stat-card.blue::before { background: linear-gradient(90deg, #3498DB, #2980B9); }
.stat-card.purple::before { background: linear-gradient(90deg, #9B59B6, #8E44AD); }
.stat-card:hover { border-color: rgba(255,255,255,0.12); }

.stat-label { font-size: 0.78rem; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
.stat-value { font-family: 'Syne', sans-serif; font-size: 1.8rem; font-weight: 800; line-height: 1; }
.stat-value.yellow { color: var(--sun); }
.stat-value.green { color: #2ECC71; }
.stat-value.blue { color: #3498DB; }
.stat-value.purple { color: #9B59B6; }
.stat-unit { font-size: 0.82rem; color: var(--muted); margin-top: 4px; }

/* CHARTS */
.charts-grid {
  display: grid; grid-template-columns: 1fr 1fr;
  gap: 20px; margin-bottom: 20px;
}
@media(max-width: 700px) { .charts-grid { grid-template-columns: 1fr; } }

.chart-card {
  background: var(--dark2); border: 1px solid var(--border2);
  border-radius: 16px; padding: 24px;
}
.chart-title {
  font-family: 'Syne', sans-serif; font-size: 0.95rem; font-weight: 700;
  margin-bottom: 20px; color: var(--text);
}
.chart-wrap { position: relative; height: 220px; }

/* ROI TABLE */
.roi-table-wrap {
  background: var(--dark2); border: 1px solid var(--border2);
  border-radius: 16px; padding: 24px; margin-bottom: 20px;
  overflow-x: auto;
}
table { width: 100%; border-collapse: collapse; }
th {
  text-align: left; font-size: 0.78rem; font-weight: 600;
  color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px;
  padding: 8px 12px; border-bottom: 1px solid var(--border2);
}
td {
  padding: 12px 12px; font-size: 0.88rem;
  border-bottom: 1px solid rgba(255,255,255,0.03);
}
tr:last-child td { border-bottom: none; }
tr.highlight td { color: var(--green); font-weight: 600; background: rgba(46,204,113,0.04); }
.td-year { color: var(--muted); }

/* SYSTEM RECOMMENDATION */
.rec-card {
  background: linear-gradient(135deg, rgba(255,184,0,0.06), rgba(255,107,43,0.04));
  border: 1px solid rgba(255,184,0,0.2);
  border-radius: 16px; padding: 28px; margin-bottom: 20px;
}
.rec-title { font-family: 'Syne', sans-serif; font-size: 1.1rem; font-weight: 700; margin-bottom: 16px; color: var(--sun); }
.rec-items { display: flex; flex-wrap: wrap; gap: 14px; }
.rec-item {
  background: rgba(255,255,255,0.04); border: 1px solid var(--border2);
  border-radius: 10px; padding: 12px 16px;
  font-size: 0.88rem;
}
.rec-item strong { color: var(--sun); display: block; font-size: 1rem; margin-bottom: 2px; }

/* TIPS */
.tips-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 14px; }
.tip-card {
  background: var(--dark2); border: 1px solid var(--border2);
  border-radius: 14px; padding: 18px;
  font-size: 0.85rem; line-height: 1.6; color: var(--muted);
  display: flex; gap: 12px;
}
.tip-icon { font-size: 1.3rem; flex-shrink: 0; margin-top: 1px; }

/* ERROR */
.error-msg {
  color: #E74C3C; font-size: 0.82rem; margin-top: 8px;
  display: none;
}
.error-msg.show { display: block; }

/* FOOTER */
footer {
  position: relative; z-index: 10;
  text-align: center; padding: 30px;
  color: var(--muted); font-size: 0.8rem;
  border-top: 1px solid var(--border2);
}

/* SCROLLBAR */
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: var(--dark2); }
::-webkit-scrollbar-thumb { background: var(--dark4); border-radius: 3px; }

/* ANIMATIONS */
.fade-in { animation: fadeIn 0.5s ease forwards; }
@keyframes fadeIn { from { opacity:0; transform:translateY(16px); } to { opacity:1; transform:translateY(0); } }

/* RESPONSIVE */
@media(max-width:600px) {
  header { padding: 16px 20px; }
  .hero { padding: 50px 16px 36px; }
  .card { padding: 20px; }
  .appliance-grid { grid-template-columns: repeat(2, 1fr); }
  .stat-grid { grid-template-columns: repeat(2, 1fr); }
}

/* URDU STYLES */
.urdu .hero h1, .urdu .card-title, .urdu .results-title, .urdu .rec-title, .urdu .chart-title {
  font-family: 'DM Sans', sans-serif;
  direction: rtl; text-align: right;
}
.urdu .card-header { flex-direction: row-reverse; }
</style>
</head>
<body>

<div class="ambient ambient-1"></div>
<div class="ambient ambient-2"></div>

<!-- HEADER -->
<header>
  <div class="logo">
    <div class="logo-icon">â˜€ï¸</div>
    Solar Energy <span>Calculator</span>
  </div>
  <div class="lang-toggle">
    <button class="lang-btn active" onclick="setLang('en')">English</button>
    <button class="lang-btn" onclick="setLang('ur')">Ø§Ø±Ø¯Ùˆ</button>
  </div>
</header>

<!-- HERO -->
<div class="hero">
  <div class="hero-tag">ğŸŒ Pakistan's Smart Solar Tool</div>
  <h1 id="hero-title">Calculate Your <em>Perfect Solar</em> System</h1>
  <p id="hero-sub">Enter your appliances, city and electricity bill â€” get an instant recommendation with savings analysis.</p>
</div>

<!-- MAIN -->
<div class="container">

  <!-- STEP INDICATORS -->
  <div class="steps">
    <div class="step active" id="step-ind-1">
      <div class="step-num">1</div>
      <span id="s1-label">City & Bill</span>
    </div>
    <div class="step-line"></div>
    <div class="step" id="step-ind-2">
      <div class="step-num">2</div>
      <span id="s2-label">Appliances</span>
    </div>
    <div class="step-line"></div>
    <div class="step" id="step-ind-3">
      <div class="step-num">3</div>
      <span id="s3-label">Results</span>
    </div>
  </div>

  <!-- STEP 1: CITY & BILL -->
  <div class="card fade-in" id="step1">
    <div class="card-header">
      <div class="card-icon">ğŸ™ï¸</div>
      <div>
        <div class="card-title" id="city-card-title">Select Your City</div>
        <div class="card-sub" id="city-card-sub">Sun hours vary by location â€” this affects system size</div>
      </div>
    </div>

    <div class="city-grid">
      <div class="city-btn" onclick="selectCity(this,'Karachi',6.5)">
        Karachi<div class="city-sun">6.5 hrs/day</div>
      </div>
      <div class="city-btn" onclick="selectCity(this,'Lahore',5.5)">
        Lahore<div class="city-sun">5.5 hrs/day</div>
      </div>
      <div class="city-btn" onclick="selectCity(this,'Islamabad',5.0)">
        Islamabad<div class="city-sun">5.0 hrs/day</div>
      </div>
      <div class="city-btn" onclick="selectCity(this,'Peshawar',5.5)">
        Peshawar<div class="city-sun">5.5 hrs/day</div>
      </div>
      <div class="city-btn" onclick="selectCity(this,'Quetta',7.0)">
        Quetta<div class="city-sun">7.0 hrs/day</div>
      </div>
      <div class="city-btn" onclick="selectCity(this,'Multan',6.5)">
        Multan<div class="city-sun">6.5 hrs/day</div>
      </div>
      <div class="city-btn" onclick="selectCity(this,'Faisalabad',5.5)">
        Faisalabad<div class="city-sun">5.5 hrs/day</div>
      </div>
      <div class="city-btn" onclick="selectCity(this,'Hyderabad',6.5)">
        Hyderabad<div class="city-sun">6.5 hrs/day</div>
      </div>
      <div class="city-btn" onclick="selectCity(this,'Sialkot',5.5)">
        Sialkot<div class="city-sun">5.5 hrs/day</div>
      </div>
      <div class="city-btn" onclick="selectCity(this,'Sukkur',7.0)">
        Sukkur<div class="city-sun">7.0 hrs/day</div>
      </div>
    </div>
    <div class="error-msg" id="err-city">âš ï¸ Please select your city first.</div>

    <!-- MONTHLY BILL -->
    <div style="margin-top:28px">
      <div style="font-size:0.9rem;font-weight:600;margin-bottom:12px" id="bill-label">Monthly Electricity Bill (WAPDA)</div>
      <div class="bill-input-wrap">
        <span class="currency">â‚¨</span>
        <input type="number" id="monthlyBill" placeholder="e.g. 15000" min="0">
      </div>
      <div style="font-size:0.75rem;color:var(--muted);margin-top:8px" id="bill-hint">Enter your average monthly bill to calculate savings & ROI</div>
    </div>

    <!-- OPTIONAL COST -->
    <div class="optional-section" style="margin-top:20px">
      <div class="optional-toggle" onclick="toggleCostOption()">
        <div class="toggle-switch" id="cost-toggle"></div>
        <div>
          <div class="optional-label" id="cost-opt-label">Custom Solar Installation Cost</div>
          <div class="optional-sub" id="cost-opt-sub">Optional â€” default: â‚¨1,50,000 per kW (market rate 2025-26)</div>
        </div>
      </div>
      <div class="optional-input-wrap" id="cost-input-wrap">
        <div style="font-size:0.82rem;color:var(--muted);margin-bottom:8px" id="cost-per-kw-label">Cost per kW (PKR):</div>
        <div class="bill-input-wrap">
          <span class="currency">â‚¨</span>
          <input type="number" id="customCostPerKw" placeholder="150000" value="150000">
        </div>
      </div>
    </div>
  </div>

  <!-- STEP 2: APPLIANCES -->
  <div class="card fade-in" id="step2" style="animation-delay:0.1s">
    <div class="card-header">
      <div class="card-icon">ğŸ”Œ</div>
      <div>
        <div class="card-title" id="app-card-title">Select Appliances</div>
        <div class="card-sub" id="app-card-sub">Choose appliances and set daily usage hours</div>
      </div>
    </div>

    <div class="appliance-grid" id="applianceGrid">
      <!-- Filled by JS -->
    </div>

    <!-- CUSTOM APPLIANCE -->
    <div style="margin-top:6px">
      <div style="font-size:0.85rem;color:var(--muted);margin-bottom:10px;font-weight:500" id="custom-label">â• Add Custom Appliance</div>
      <div class="custom-add">
        <div class="field">
          <label id="lbl-name">Appliance Name</label>
          <input type="text" id="customName" placeholder="e.g. Water Pump">
        </div>
        <div class="field" style="max-width:110px">
          <label id="lbl-watts">Watts</label>
          <input type="number" id="customWatts" placeholder="500">
        </div>
        <div class="field" style="max-width:110px">
          <label id="lbl-hours">Hours/day</label>
          <input type="number" id="customHours" placeholder="4">
        </div>
        <div class="field" style="max-width:80px">
          <label id="lbl-qty">Qty</label>
          <input type="number" id="customQty" placeholder="1" value="1">
        </div>
        <button class="add-btn" onclick="addCustomAppliance()" id="btn-add">Add</button>
      </div>
    </div>

    <div id="customList" style="margin-top:12px;display:flex;flex-wrap:wrap;gap:8px"></div>

    <div class="error-msg" id="err-app">âš ï¸ Please select at least one appliance.</div>

    <button class="calc-btn" onclick="calculate()" id="calc-btn-text">
      âš¡ Calculate My Solar System
    </button>
  </div>

  <!-- RESULTS -->
  <div id="results">

    <!-- TOP STATS -->
    <div class="results-header">
      <div class="results-title" id="results-title">Your Solar Report</div>
      <button class="pdf-btn" onclick="downloadPDF()">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
          <polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/>
          <line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/>
        </svg>
        <span id="pdf-btn-text">Download PDF Report</span>
      </button>
    </div>

    <div class="stat-grid" id="statGrid"></div>

    <!-- RECOMMENDATION -->
    <div class="rec-card" id="recCard"></div>

    <!-- CHARTS -->
    <div class="charts-grid">
      <div class="chart-card">
        <div class="chart-title" id="chart1-title">âš¡ Daily Energy by Appliance</div>
        <div class="chart-wrap"><canvas id="applianceChart"></canvas></div>
      </div>
      <div class="chart-card">
        <div class="chart-title" id="chart2-title">ğŸ’° Monthly Cost: Before vs After Solar</div>
        <div class="chart-wrap"><canvas id="savingsChart"></canvas></div>
      </div>
    </div>

    <!-- ROI TABLE -->
    <div class="roi-table-wrap" id="roiTableWrap">
      <div class="chart-title" id="roi-title" style="margin-bottom:16px">ğŸ“… Year-by-Year ROI Breakdown</div>
      <table id="roiTable"></table>
    </div>

    <!-- TIPS -->
    <div class="card">
      <div class="card-header">
        <div class="card-icon">ğŸ’¡</div>
        <div><div class="card-title" id="tips-title">Pro Tips to Maximize Savings</div></div>
      </div>
      <div class="tips-grid" id="tipsGrid"></div>
    </div>

  </div>
</div>

<footer>
  <p>â˜€ï¸ Solar Energy Calculator â€” Pakistan | Data based on 2025-26 market rates</p>
  <p style="margin-top:4px;font-size:0.72rem">Estimates are approximate. Consult a certified solar installer for final sizing.</p>
</footer>

<script>
// ===================== DATA =====================
const appliancesData = [
  { id:'ac',   name:'Air Conditioner', urdu:'Ø§ÛŒØ¦Ø± Ú©Ù†ÚˆÛŒØ´Ù†Ø±', emoji:'â„ï¸', watts:1500, defaultHours:8,  qty:1 },
  { id:'fan',  name:'Ceiling Fan',     urdu:'Ú†Ú¾Øª Ú©Ø§ Ù¾Ù†Ú©Ú¾Ø§',  emoji:'ğŸŒ€', watts:75,   defaultHours:12, qty:4 },
  { id:'fridge',name:'Refrigerator',  urdu:'ÙØ±ÛŒØ¬',           emoji:'ğŸ§Š', watts:150,  defaultHours:24, qty:1 },
  { id:'tv',   name:'LED TV',          urdu:'Ù¹ÛŒ ÙˆÛŒ',          emoji:'ğŸ“º', watts:100,  defaultHours:6,  qty:1 },
  { id:'lights',name:'LED Lights',    urdu:'Ø¨Ù„Ø¨ / Ù„Ø§Ø¦Ù¹Ø³',   emoji:'ğŸ’¡', watts:10,   defaultHours:8,  qty:10 },
  { id:'wash', name:'Washing Machine', urdu:'ÙˆØ§Ø´Ù†Ú¯ Ù…Ø´ÛŒÙ†',    emoji:'ğŸ«§', watts:500,  defaultHours:2,  qty:1 },
  { id:'iron', name:'Iron',            urdu:'Ø§Ø³ØªØ±ÛŒ',          emoji:'ğŸ‘”', watts:1000, defaultHours:1,  qty:1 },
  { id:'geyser',name:'Water Geyser',  urdu:'Ú¯ÛŒØ²Ø±',           emoji:'ğŸš¿', watts:2000, defaultHours:2,  qty:1 },
  { id:'pc',   name:'Computer/Laptop', urdu:'Ú©Ù…Ù¾ÛŒÙˆÙ¹Ø±',       emoji:'ğŸ’»', watts:150,  defaultHours:6,  qty:1 },
  { id:'pump', name:'Water Motor',     urdu:'ÙˆØ§Ù¹Ø± Ù…ÙˆÙ¹Ø±',     emoji:'ğŸ’§', watts:750,  defaultHours:3,  qty:1 },
  { id:'micro',name:'Microwave',       urdu:'Ù…Ø§Ø¦ÛŒÚ©Ø±Ùˆ ÙˆÛŒÙˆ',   emoji:'ğŸ“¦', watts:1200, defaultHours:0.5,qty:1 },
  { id:'mixer',name:'Mixer/Grinder',  urdu:'Ù…Ú©Ø³Ø±',           emoji:'ğŸµ', watts:400,  defaultHours:0.5,qty:1 },
];

let selectedCity = null;
let sunHours = 5.5;
let selectedAppliances = {};
let customAppliances = [];
let customCostEnabled = false;
let lang = 'en';
let charts = {};

const translations = {
  en: {
    heroTitle: 'Calculate Your <em>Perfect Solar</em> System',
    heroSub: 'Enter your appliances, city and electricity bill â€” get an instant recommendation with savings analysis.',
    cityTitle: 'Select Your City',
    citySub: 'Sun hours vary by location â€” this affects system size',
    billLabel: 'Monthly Electricity Bill (WAPDA)',
    billHint: 'Enter your average monthly bill to calculate savings & ROI',
    costOptLabel: 'Custom Solar Installation Cost',
    costOptSub: 'Optional â€” default: â‚¨1,50,000 per kW (market rate 2025-26)',
    costPerKwLabel: 'Cost per kW (PKR):',
    appTitle: 'Select Appliances',
    appSub: 'Choose appliances and set daily usage hours',
    customLabel: 'â• Add Custom Appliance',
    lblName: 'Appliance Name', lblWatts: 'Watts', lblHours: 'Hours/day', lblQty: 'Qty',
    btnAdd: 'Add',
    calcBtn: 'âš¡ Calculate My Solar System',
    resultsTitle: 'Your Solar Report',
    pdfBtn: 'Download PDF Report',
    s1: 'City & Bill', s2: 'Appliances', s3: 'Results',
    chart1: 'âš¡ Daily Energy by Appliance',
    chart2: 'ğŸ’° Monthly Cost: Before vs After Solar',
    roiTitle: 'ğŸ“… Year-by-Year ROI Breakdown',
    tipsTitle: 'Pro Tips to Maximize Savings',
    errCity: 'âš ï¸ Please select your city first.',
    errApp: 'âš ï¸ Please select at least one appliance.',
  },
  ur: {
    heroTitle: 'Ø§Ù¾Ù†Ø§ <em>Ø¨ÛØªØ±ÛŒÙ† Ø³ÙˆÙ„Ø± Ø³Ø³Ù¹Ù…</em> Ù…Ø¹Ù„ÙˆÙ… Ú©Ø±ÛŒÚº',
    heroSub: 'Ø§Ù¾Ù„Ø§Ø¦Ù†Ø³Ø²ØŒ Ø´ÛØ± Ø§ÙˆØ± Ø¨Ø¬Ù„ÛŒ Ú©Ø§ Ø¨Ù„ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº â€” ÙÙˆØ±ÛŒ Ø³ÙØ§Ø±Ø´ Ø§ÙˆØ± Ø¨Ú†Øª Ú©Ø§ ØªØ¬Ø²ÛŒÛ Ù¾Ø§Ø¦ÛŒÚº',
    cityTitle: 'Ø§Ù¾Ù†Ø§ Ø´ÛØ± Ú†Ù†ÛŒÚº',
    citySub: 'Ø³ÙˆØ±Ø¬ Ú©Û’ Ú¯Ú¾Ù†Ù¹Û’ Ù…Ù‚Ø§Ù… Ú©Û’ Ø­Ø³Ø§Ø¨ Ø³Û’ Ù…Ø®ØªÙ„Ù ÛÙˆØªÛ’ ÛÛŒÚº',
    billLabel: 'Ù…Ø§ÛØ§Ù†Û Ø¨Ø¬Ù„ÛŒ Ú©Ø§ Ø¨Ù„ (ÙˆØ§Ù¾ÚˆØ§)',
    billHint: 'Ø¨Ú†Øª Ø§ÙˆØ± ROI Ø­Ø³Ø§Ø¨ Ú©Û’ Ù„ÛŒÛ’ Ø§ÙˆØ³Ø· Ù…Ø§ÛØ§Ù†Û Ø¨Ù„ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº',
    costOptLabel: 'Ø§Ù¾Ù†ÛŒ Ø³ÙˆÙ„Ø± Ø§Ù†Ø³Ù¹Ø§Ù„ÛŒØ´Ù† Ù„Ø§Ú¯Øª Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº',
    costOptSub: 'Ø§Ø®ØªÛŒØ§Ø±ÛŒ â€” ÚˆÛŒÙØ§Ù„Ù¹: â‚¨1,50,000 ÙÛŒ Ú©Ù„Ùˆ ÙˆØ§Ù¹',
    costPerKwLabel: 'ÙÛŒ Ú©Ù„Ùˆ ÙˆØ§Ù¹ Ù„Ø§Ú¯Øª (Ø±ÙˆÙ¾Û’):',
    appTitle: 'Ø§Ù¾Ù„Ø§Ø¦Ù†Ø³Ø² Ú†Ù†ÛŒÚº',
    appSub: 'Ø§Ù¾Ù„Ø§Ø¦Ù†Ø³Ø² Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº Ø§ÙˆØ± Ø±ÙˆØ²Ø§Ù†Û Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Û’ Ú¯Ú¾Ù†Ù¹Û’ Ø¯Ø±Ø¬ Ú©Ø±ÛŒÚº',
    customLabel: 'â• Ø§Ù¾Ù†Ø§ Ø§Ù¾Ù„Ø§Ø¦Ù†Ø³ Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº',
    lblName: 'Ø§Ù¾Ù„Ø§Ø¦Ù†Ø³ Ú©Ø§ Ù†Ø§Ù…', lblWatts: 'ÙˆØ§Ù¹', lblHours: 'Ú¯Ú¾Ù†Ù¹Û’/Ø¯Ù†', lblQty: 'ØªØ¹Ø¯Ø§Ø¯',
    btnAdd: 'Ø´Ø§Ù…Ù„ Ú©Ø±ÛŒÚº',
    calcBtn: 'âš¡ Ù…ÛŒØ±Ø§ Ø³ÙˆÙ„Ø± Ø³Ø³Ù¹Ù… Ø­Ø³Ø§Ø¨ Ú©Ø±ÛŒÚº',
    resultsTitle: 'Ø¢Ù¾ Ú©ÛŒ Ø³ÙˆÙ„Ø± Ø±Ù¾ÙˆØ±Ù¹',
    pdfBtn: 'PDF Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù†Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº',
    s1: 'Ø´ÛØ± Ùˆ Ø¨Ù„', s2: 'Ø§Ù¾Ù„Ø§Ø¦Ù†Ø³Ø²', s3: 'Ù†ØªØ§Ø¦Ø¬',
    chart1: 'âš¡ Ø§Ù¾Ù„Ø§Ø¦Ù†Ø³ Ú©Û’ Ù…Ø·Ø§Ø¨Ù‚ Ø±ÙˆØ²Ø§Ù†Û ØªÙˆØ§Ù†Ø§Ø¦ÛŒ',
    chart2: 'ğŸ’° Ù…Ø§ÛØ§Ù†Û Ù„Ø§Ú¯Øª: Ø³ÙˆÙ„Ø± Ø³Û’ Ù¾ÛÙ„Û’ Ø§ÙˆØ± Ø¨Ø¹Ø¯',
    roiTitle: 'ğŸ“… Ø³Ø§Ù„ Ø¨Û Ø³Ø§Ù„ ROI ØªØ¬Ø²ÛŒÛ',
    tipsTitle: 'Ø¨Ú†Øª Ø¨Ú‘Ú¾Ø§Ù†Û’ Ú©Û’ Ø§ÛÙ… Ù…Ø´ÙˆØ±Û’',
    errCity: 'âš ï¸ Ø¨Ø±Ø§Û Ú©Ø±Ù… Ù¾ÛÙ„Û’ Ø§Ù¾Ù†Ø§ Ø´ÛØ± Ú†Ù†ÛŒÚºÛ”',
    errApp: 'âš ï¸ Ú©Ù… Ø§Ø² Ú©Ù… Ø§ÛŒÚ© Ø§Ù¾Ù„Ø§Ø¦Ù†Ø³ Ø¶Ø±ÙˆØ± Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚºÛ”',
  }
};

// ===================== INIT =====================
function init() {
  renderAppliances();
}

function renderAppliances() {
  const grid = document.getElementById('applianceGrid');
  grid.innerHTML = '';
  appliancesData.forEach(a => {
    const sel = selectedAppliances[a.id];
    const isSel = !!sel;
    const hours = sel ? sel.hours : a.defaultHours;
    const qty = sel ? sel.qty : a.qty;

    const el = document.createElement('div');
    el.className = 'appliance-item' + (isSel ? ' selected' : '');
    el.id = 'app-' + a.id;
    el.onclick = (e) => {
      if (!e.target.classList.contains('qty-btn') && !e.target.classList.contains('hours-input')) {
        toggleAppliance(a.id, a);
      }
    };
    el.innerHTML = `
      <div class="appliance-top">
        <span class="appliance-emoji">${a.emoji}</span>
        <div class="appliance-check">${isSel ? 'âœ“' : ''}</div>
      </div>
      <div class="appliance-name">${lang === 'ur' ? a.urdu : a.name}</div>
      <div class="appliance-watts">${a.watts}W</div>
      <div class="appliance-controls">
        <div>
          <div class="hours-label">${lang === 'ur' ? 'Ú¯Ú¾Ù†Ù¹Û’/Ø¯Ù†' : 'Hrs/day'}</div>
          <input class="hours-input" type="number" value="${hours}" min="0.5" max="24" step="0.5"
            onchange="updateHours('${a.id}', this.value)" onclick="event.stopPropagation()">
        </div>
        <div class="qty-wrap">
          <button class="qty-btn" onclick="event.stopPropagation(); updateQty('${a.id}', -1)">âˆ’</button>
          <span class="qty-val" id="qty-${a.id}">${qty}</span>
          <button class="qty-btn" onclick="event.stopPropagation(); updateQty('${a.id}', 1)">+</button>
        </div>
      </div>
    `;
    grid.appendChild(el);
  });
}

function toggleAppliance(id, data) {
  if (selectedAppliances[id]) {
    delete selectedAppliances[id];
  } else {
    selectedAppliances[id] = { ...data, hours: data.defaultHours, qty: data.qty };
  }
  renderAppliances();
}

function updateHours(id, val) {
  if (selectedAppliances[id]) selectedAppliances[id].hours = parseFloat(val) || 1;
}
function updateQty(id, delta) {
  if (selectedAppliances[id]) {
    selectedAppliances[id].qty = Math.max(1, (selectedAppliances[id].qty || 1) + delta);
    document.getElementById('qty-' + id).textContent = selectedAppliances[id].qty;
  }
}

// ===================== CITY =====================
function selectCity(el, name, hours) {
  document.querySelectorAll('.city-btn').forEach(b => b.classList.remove('selected'));
  el.classList.add('selected');
  selectedCity = name;
  sunHours = hours;
}

// ===================== COST TOGGLE =====================
function toggleCostOption() {
  customCostEnabled = !customCostEnabled;
  const toggle = document.getElementById('cost-toggle');
  const wrap = document.getElementById('cost-input-wrap');
  toggle.classList.toggle('on', customCostEnabled);
  wrap.classList.toggle('show', customCostEnabled);
}

// ===================== CUSTOM APPLIANCE =====================
function addCustomAppliance() {
  const name = document.getElementById('customName').value.trim();
  const watts = parseFloat(document.getElementById('customWatts').value);
  const hours = parseFloat(document.getElementById('customHours').value);
  const qty = parseInt(document.getElementById('customQty').value) || 1;
  if (!name || !watts || !hours) return;

  const id = 'custom_' + Date.now();
  customAppliances.push({ id, name, watts, hours, qty });
  renderCustomList();

  document.getElementById('customName').value = '';
  document.getElementById('customWatts').value = '';
  document.getElementById('customHours').value = '';
  document.getElementById('customQty').value = '1';
}

function removeCustom(id) {
  customAppliances = customAppliances.filter(a => a.id !== id);
  renderCustomList();
}

function renderCustomList() {
  const el = document.getElementById('customList');
  el.innerHTML = customAppliances.map(a => `
    <div style="display:flex;align-items:center;gap:8px;background:var(--dark3);border:1px solid var(--border2);border-radius:8px;padding:8px 12px;font-size:0.82rem;">
      <span>${a.name} (${a.watts}W Ã— ${a.hours}h Ã— ${a.qty})</span>
      <button onclick="removeCustom('${a.id}')" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:1rem;margin-left:4px;">âœ•</button>
    </div>
  `).join('');
}

// ===================== CALCULATE =====================
function calculate() {
  // Validation
  document.getElementById('err-city').classList.remove('show');
  document.getElementById('err-app').classList.remove('show');

  if (!selectedCity) {
    document.getElementById('err-city').classList.add('show');
    document.getElementById('step1').scrollIntoView({ behavior: 'smooth' });
    return;
  }

  const allAppliances = [
    ...Object.values(selectedAppliances),
    ...customAppliances
  ];

  if (allAppliances.length === 0) {
    document.getElementById('err-app').classList.add('show');
    return;
  }

  // ---- ENERGY CALCULATION ----
  let totalWh = 0;
  allAppliances.forEach(a => {
    totalWh += a.watts * (a.hours || a.defaultHours || 1) * (a.qty || 1);
  });

  const dailyKwh = totalWh / 1000;
  const monthlyKwh = dailyKwh * 30;

  // System size with 20% buffer + system loss
  const systemKw = Math.ceil((dailyKwh / (sunHours * 0.8)) * 10) / 10;
  const panels = Math.ceil((systemKw * 1000) / 550); // 550W panels

  // Cost
  const costPerKw = customCostEnabled
    ? (parseFloat(document.getElementById('customCostPerKw').value) || 150000)
    : 150000;
  const totalCost = systemKw * costPerKw;

  // Bill & Savings
  const monthlyBill = parseFloat(document.getElementById('monthlyBill').value) || 0;
  const wapda = 65; // PKR per unit
  const currentMonthlyKwhCost = monthlyBill > 0 ? monthlyBill : monthlyKwh * wapda;
  const solarMonthlyCost = monthlyKwh * wapda * 0.1; // ~90% offset
  const monthlySaving = currentMonthlyKwhCost - solarMonthlyCost;
  const annualSaving = monthlySaving * 12;
  const roiYears = totalCost > 0 ? (totalCost / annualSaving).toFixed(1) : 'N/A';

  // ---- RENDER ----
  renderStats({ systemKw, panels, totalCost, monthlySaving, dailyKwh, monthlyKwh, roiYears });
  renderRecommendation({ systemKw, panels, totalCost, costPerKw });
  renderCharts(allAppliances, currentMonthlyKwhCost, solarMonthlyCost, totalCost, annualSaving);
  renderROITable(totalCost, annualSaving);
  renderTips();

  const results = document.getElementById('results');
  results.classList.add('show');
  results.classList.add('fade-in');
  results.scrollIntoView({ behavior: 'smooth', block: 'start' });

  // Update step indicators
  document.getElementById('step-ind-1').classList.remove('active');
  document.getElementById('step-ind-1').classList.add('done');
  document.getElementById('step-ind-1').querySelector('.step-num').textContent = 'âœ“';
  document.getElementById('step-ind-2').classList.remove('active');
  document.getElementById('step-ind-2').classList.add('done');
  document.getElementById('step-ind-2').querySelector('.step-num').textContent = 'âœ“';
  document.getElementById('step-ind-3').classList.add('active');
}

function renderStats({ systemKw, panels, totalCost, monthlySaving, dailyKwh, monthlyKwh, roiYears }) {
  const t = lang;
  document.getElementById('statGrid').innerHTML = `
    <div class="stat-card yellow">
      <div class="stat-label">${t === 'ur' ? 'Ø³Ø³Ù¹Ù… Ø³Ø§Ø¦Ø²' : 'System Size'}</div>
      <div class="stat-value yellow">${systemKw}</div>
      <div class="stat-unit">kW</div>
    </div>
    <div class="stat-card blue">
      <div class="stat-label">${t === 'ur' ? 'Ø³ÙˆÙ„Ø± Ù¾ÛŒÙ†Ù„' : 'Solar Panels'}</div>
      <div class="stat-value blue">${panels}</div>
      <div class="stat-unit">${t === 'ur' ? '550W Ù¾ÛŒÙ†Ù„' : '550W panels'}</div>
    </div>
    <div class="stat-card green">
      <div class="stat-label">${t === 'ur' ? 'Ù…Ø§ÛØ§Ù†Û Ø¨Ú†Øª' : 'Monthly Saving'}</div>
      <div class="stat-value green">â‚¨${formatNum(Math.round(monthlySaving))}</div>
      <div class="stat-unit">${t === 'ur' ? 'ÙÛŒ Ù…ÛÛŒÙ†Û' : 'per month'}</div>
    </div>
    <div class="stat-card purple">
      <div class="stat-label">${t === 'ur' ? 'Ø³Ø±Ù…Ø§ÛŒÛ ÙˆØ§Ù¾Ø³ÛŒ' : 'ROI Period'}</div>
      <div class="stat-value purple">${roiYears}</div>
      <div class="stat-unit">${t === 'ur' ? 'Ø³Ø§Ù„' : 'years'}</div>
    </div>
    <div class="stat-card yellow">
      <div class="stat-label">${t === 'ur' ? 'Ú©Ù„ Ù„Ø§Ú¯Øª' : 'Total Cost'}</div>
      <div class="stat-value yellow" style="font-size:1.4rem">â‚¨${formatNum(Math.round(totalCost))}</div>
      <div class="stat-unit">${t === 'ur' ? 'ØªØ®Ù…ÛŒÙ†Û' : 'estimated'}</div>
    </div>
    <div class="stat-card blue">
      <div class="stat-label">${t === 'ur' ? 'Ø±ÙˆØ²Ø§Ù†Û ØªÙˆØ§Ù†Ø§Ø¦ÛŒ' : 'Daily Energy'}</div>
      <div class="stat-value blue">${dailyKwh.toFixed(1)}</div>
      <div class="stat-unit">kWh/day</div>
    </div>
  `;
}

function renderRecommendation({ systemKw, panels, totalCost, costPerKw }) {
  const t = lang;
  document.getElementById('recCard').innerHTML = `
    <div class="rec-title">â˜€ï¸ ${t === 'ur' ? 'ØªØ¬ÙˆÛŒØ² Ú©Ø±Ø¯Û Ø³Ø³Ù¹Ù…' : 'Recommended System'} â€” ${selectedCity}</div>
    <div class="rec-items">
      <div class="rec-item"><strong>${systemKw} kW</strong>${t === 'ur' ? 'Ø³Ø³Ù¹Ù… Ø³Ø§Ø¦Ø²' : 'System Size'}</div>
      <div class="rec-item"><strong>${panels} Ù¾ÛŒÙ†Ù„</strong>${t === 'ur' ? '550W Ù…ÙˆÙ†Ùˆ Ù¾Ø±Ú©' : '550W Mono PERC'}</div>
      <div class="rec-item"><strong>${systemKw >= 5 ? '3-Phase' : 'Single Phase'}</strong>${t === 'ur' ? 'Ø§Ù†ÙˆØ±Ù¹Ø±' : 'Inverter'}</div>
      <div class="rec-item"><strong>â‚¨${formatNum(Math.round(totalCost))}</strong>${t === 'ur' ? 'Ú©Ù„ Ù„Ø§Ú¯Øª' : 'Total Cost'}</div>
      <div class="rec-item"><strong>${sunHours} hrs</strong>${t === 'ur' ? 'Ø±ÙˆØ²Ø§Ù†Û Ø³ÙˆØ±Ø¬' : 'Sun Hours/day'}</div>
      <div class="rec-item"><strong>25 ${t === 'ur' ? 'Ø³Ø§Ù„' : 'yrs'}</strong>${t === 'ur' ? 'Ù¾ÛŒÙ†Ù„ ÙˆØ§Ø±Ù†Ù¹ÛŒ' : 'Panel Warranty'}</div>
    </div>
  `;
}

function renderCharts(appliances, currentCost, solarCost, totalCost, annualSaving) {
  // Destroy old charts
  Object.values(charts).forEach(c => c.destroy && c.destroy());
  charts = {};

  // Chart 1 â€” Appliance energy
  const labels = appliances.map(a => (a.name || a.urdu) + (a.qty > 1 ? ` Ã—${a.qty}` : ''));
  const data1 = appliances.map(a => ((a.watts * (a.hours || a.defaultHours || 1) * (a.qty || 1)) / 1000).toFixed(2));
  const colors = ['#FFB800','#FF6B2B','#3498DB','#2ECC71','#9B59B6','#E74C3C','#1ABC9C','#F39C12','#34495E','#E91E63','#00BCD4','#FF5722'];

  const ctx1 = document.getElementById('applianceChart').getContext('2d');
  charts.c1 = new Chart(ctx1, {
    type: 'doughnut',
    data: {
      labels,
      datasets: [{ data: data1, backgroundColor: colors, borderColor: 'transparent', borderWidth: 2 }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: {
        legend: { position: 'right', labels: { color: '#8B949E', font: { size: 10 }, boxWidth: 12, padding: 8 } }
      }
    }
  });

  // Chart 2 â€” Savings bar
  const ctx2 = document.getElementById('savingsChart').getContext('2d');
  charts.c2 = new Chart(ctx2, {
    type: 'bar',
    data: {
      labels: ['Current Bill', 'With Solar', 'Annual Saving'],
      datasets: [{
        data: [Math.round(currentCost), Math.round(solarCost), Math.round(annualSaving/12)],
        backgroundColor: ['#E74C3C', '#2ECC71', '#FFB800'],
        borderRadius: 8, borderSkipped: false
      }]
    },
    options: {
      responsive: true, maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      scales: {
        x: { ticks: { color: '#8B949E', font: { size: 10 } }, grid: { color: 'rgba(255,255,255,0.04)' } },
        y: { ticks: { color: '#8B949E', font: { size: 10 }, callback: v => 'â‚¨' + formatNum(v) }, grid: { color: 'rgba(255,255,255,0.04)' } }
      }
    }
  });
}

function renderROITable(totalCost, annualSaving) {
  const t = lang;
  let html = `<thead><tr>
    <th>${t === 'ur' ? 'Ø³Ø§Ù„' : 'Year'}</th>
    <th>${t === 'ur' ? 'Ø³Ø§Ù„Ø§Ù†Û Ø¨Ú†Øª' : 'Annual Saving'}</th>
    <th>${t === 'ur' ? 'Ú©Ù„ Ø¨Ú†Øª' : 'Cumulative Saving'}</th>
    <th>${t === 'ur' ? 'Ú©Ù„ Ù„Ø§Ú¯Øª' : 'Total Cost'}</th>
    <th>${t === 'ur' ? 'Ù…Ù†Ø§ÙØ¹ / Ù†Ù‚ØµØ§Ù†' : 'Net P&L'}</th>
  </tr></thead><tbody>`;

  let cumSaving = 0;
  const breakEvenYear = Math.ceil(totalCost / annualSaving);

  for (let y = 1; y <= 20; y++) {
    cumSaving += annualSaving;
    const net = cumSaving - totalCost;
    const isBreak = y === breakEvenYear;
    html += `<tr class="${isBreak ? 'highlight' : ''}">
      <td class="td-year">${y}${isBreak ? ' ğŸ¯' : ''}</td>
      <td>â‚¨${formatNum(Math.round(annualSaving))}</td>
      <td>â‚¨${formatNum(Math.round(cumSaving))}</td>
      <td>â‚¨${formatNum(Math.round(totalCost))}</td>
      <td style="color:${net >= 0 ? '#2ECC71' : '#E74C3C'}">${net >= 0 ? '+' : ''}â‚¨${formatNum(Math.round(net))}</td>
    </tr>`;
  }
  html += '</tbody>';
  document.getElementById('roiTable').innerHTML = html;
}

function renderTips() {
  const t = lang;
  const tips = t === 'ur' ? [
    { icon: 'ğŸŒ¤ï¸', text: 'Ù¾ÛŒÙ†Ù„ Ú©Ùˆ Ø¬Ù†ÙˆØ¨ Ú©ÛŒ Ø·Ø±Ù 25-30 ÚˆÚ¯Ø±ÛŒ Ù¾Ø± Ù†ØµØ¨ Ú©Ø±ÛŒÚº Ø²ÛŒØ§Ø¯Û Ø¯Ú¾ÙˆÙ¾ Ú©Û’ Ù„ÛŒÛ’' },
    { icon: 'ğŸ”‹', text: 'Ø¨ÛŒÙ¹Ø±ÛŒ Ù„Ú¯Ø§Ù†Û’ Ø³Û’ Ø±Ø§Øª Ø§ÙˆØ± Ù„ÙˆÚˆ Ø´ÛŒÚˆÙ†Ú¯ Ù…ÛŒÚº Ø¨Ú¾ÛŒ ÙØ§Ø¦Ø¯Û ÛÙˆÚ¯Ø§' },
    { icon: 'âš¡', text: 'Ø¨Ú¾Ø§Ø±ÛŒ Ø§Ù¾Ù„Ø§Ø¦Ù†Ø³ Ø¬ÛŒØ³Û’ AC Ø§ÙˆØ± Ú¯ÛŒØ²Ø± Ø¯ÙˆÙ¾ÛØ± Ù…ÛŒÚº Ø§Ø³ØªØ¹Ù…Ø§Ù„ Ú©Ø±ÛŒÚº' },
    { icon: 'ğŸŒ¡ï¸', text: 'Ù¾ÛŒÙ†Ù„ ØµØ§Ù Ø±Ú©Ú¾ÛŒÚº â€” Ú¯Ø±Ø¯ Ø³Û’ 15-25% Ú©Ø§Ø±Ú©Ø±Ø¯Ú¯ÛŒ Ú©Ù… ÛÙˆØªÛŒ ÛÛ’' },
    { icon: 'ğŸ“Š', text: 'Ù†ÛŒÙ¹ Ù…ÛŒÙ¹Ø±Ù†Ú¯ Ø³Û’ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø¬Ù„ÛŒ ÙˆØ§Ù¾ÚˆØ§ Ú©Ùˆ Ø¨ÛŒÚ† Ú©Ø± Ù…Ø²ÛŒØ¯ Ú©Ù…Ø§Ø¦ÛŒ Ú©Ø±ÛŒÚº' },
    { icon: 'ğŸ”§', text: 'Ø³Ø§Ù„ Ù…ÛŒÚº Ø§ÛŒÚ© Ø¨Ø§Ø± Ø§Ù†ÙˆØ±Ù¹Ø± Ø§ÙˆØ± Ú©Ù†Ú©Ø´Ù† Ú†ÛŒÚ© Ú©Ø±ÙˆØ§Ø¦ÛŒÚº' },
  ] : [
    { icon: 'ğŸŒ¤ï¸', text: 'Install panels facing south at 25-30Â° angle for maximum sunlight exposure' },
    { icon: 'ğŸ”‹', text: 'Add battery storage to use solar power during load shedding and nighttime' },
    { icon: 'âš¡', text: 'Run heavy appliances like AC and geyser during peak sun hours (10am-3pm)' },
    { icon: 'ğŸŒ¡ï¸', text: 'Clean panels regularly â€” dust can reduce efficiency by 15-25%' },
    { icon: 'ğŸ“Š', text: 'Apply for net metering to sell excess electricity back to WAPDA and earn more' },
    { icon: 'ğŸ”§', text: 'Get annual maintenance checks on inverter and connections for long system life' },
  ];
  document.getElementById('tipsGrid').innerHTML = tips.map(tip => `
    <div class="tip-card"><span class="tip-icon">${tip.icon}</span><span>${tip.text}</span></div>
  `).join('');
}

// ===================== LANGUAGE =====================
function setLang(l) {
  lang = l;
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
  event.target.classList.add('active');

  const T = translations[l];
  document.getElementById('hero-title').innerHTML = T.heroTitle;
  document.getElementById('hero-sub').textContent = T.heroSub;
  document.getElementById('city-card-title').textContent = T.cityTitle;
  document.getElementById('city-card-sub').textContent = T.citySub;
  document.getElementById('bill-label').textContent = T.billLabel;
  document.getElementById('bill-hint').textContent = T.billHint;
  document.getElementById('cost-opt-label').textContent = T.costOptLabel;
  document.getElementById('cost-opt-sub').textContent = T.costOptSub;
  document.getElementById('cost-per-kw-label').textContent = T.costPerKwLabel;
  document.getElementById('app-card-title').textContent = T.appTitle;
  document.getElementById('app-card-sub').textContent = T.appSub;
  document.getElementById('custom-label').textContent = T.customLabel;
  document.getElementById('lbl-name').textContent = T.lblName;
  document.getElementById('lbl-watts').textContent = T.lblWatts;
  document.getElementById('lbl-hours').textContent = T.lblHours;
  document.getElementById('lbl-qty').textContent = T.lblQty;
  document.getElementById('btn-add').textContent = T.btnAdd;
  document.getElementById('calc-btn-text').textContent = T.calcBtn;
  document.getElementById('results-title').textContent = T.resultsTitle;
  document.getElementById('pdf-btn-text').textContent = T.pdfBtn;
  document.getElementById('s1-label').textContent = T.s1;
  document.getElementById('s2-label').textContent = T.s2;
  document.getElementById('s3-label').textContent = T.s3;
  document.getElementById('chart1-title').textContent = T.chart1;
  document.getElementById('chart2-title').textContent = T.chart2;
  document.getElementById('roi-title').textContent = T.roiTitle;
  document.getElementById('tips-title').textContent = T.tipsTitle;
  document.getElementById('err-city').textContent = T.errCity;
  document.getElementById('err-app').textContent = T.errApp;

  renderAppliances();
}

// ===================== PDF =====================
async function downloadPDF() {
  const { jsPDF } = window.jspdf;
  const btn = document.querySelector('.pdf-btn');
  btn.textContent = 'â³ Generating...';

  const el = document.getElementById('results');
  const canvas = await html2canvas(el, {
    scale: 1.5,
    backgroundColor: '#080C10',
    useCORS: true,
    logging: false
  });

  const imgData = canvas.toDataURL('image/jpeg', 0.92);
  const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });

  const pageW = pdf.internal.pageSize.getWidth();
  const pageH = pdf.internal.pageSize.getHeight();
  const imgW = canvas.width;
  const imgH = canvas.height;
  const ratio = pageW / imgW;
  const scaledH = imgH * ratio;

  let yPos = 0;
  let remaining = scaledH;

  while (remaining > 0) {
    pdf.addImage(imgData, 'JPEG', 0, -yPos, pageW, scaledH);
    remaining -= pageH;
    yPos += pageH;
    if (remaining > 0) pdf.addPage();
  }

  pdf.save(`Solar-Report-${selectedCity || 'Pakistan'}.pdf`);
  btn.innerHTML = `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:16px;height:16px"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg> <span>${lang === 'ur' ? 'PDF Ø±Ù¾ÙˆØ±Ù¹ ÚˆØ§Ø¤Ù†Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº' : 'Download PDF Report'}</span>`;
}

// ===================== UTILS =====================
function formatNum(n) {
  return n.toLocaleString('en-PK');
}

// ===================== START =====================
init();
</script>
</body>
</html>
